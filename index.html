<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ØªØ°ÙƒÙŠØ± ÙˆÙØ§Ø¡</title>

<!-- Flatpickr -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
<script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>
<script src="https://cdn.jsdelivr.net/npm/flatpickr/dist/l10n/ar.js"></script>

<!-- Firebase SDKs -->
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.14.0/firebase-messaging-compat.js"></script>

<style>
    body { font-family: Arial, sans-serif; margin: 0; padding-bottom: 80px; background: #f4f4f4; direction: rtl; }
    header { background: #4a90e2; color: white; padding: 15px; text-align: center; font-size: 1.5em; }
    .container { max-width: 800px; margin: 20px auto; padding: 15px; background: white; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.2); }
    .form-group { margin-bottom: 16px; }
    label { display: block; margin-bottom: 8px; font-weight: bold; color: #333; }
    input, select { width: 100%; padding: 12px; font-size: 1em; border-radius: 6px; border: 1px solid #ccc; }
    table { width: 100%; border-collapse: collapse; margin-top: 15px; }
    th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
    th { background: #4a90e2; color: white; }
    .tabs { position: fixed; bottom: 0; left: 0; width: 100%; background: #800080; display: flex; justify-content: space-around; }
    .tabs button { flex: 1; padding: 15px; border: none; background: #a64ca6; color: white; font-size: 1em; cursor: pointer; }
    .tabs button:hover { background: #993399; }
    .tab-content { display: none; }

    /* Popup */
    #popupOverlay { display: none; position: fixed; inset: 0; background: rgba(0,0,0,0.4); z-index: 999; }
    #popup { position: fixed; top: 50%; left: 50%; transform: translate(-50%,-50%); background: #fff; border: 2px solid #4a90e2; border-radius: 10px; padding: 20px; width: 90%; max-width: 420px; box-shadow: 0 8px 24px rgba(0,0,0,0.3); z-index: 1000; display: none; }
    #popup h3 { margin: 0 0 10px; color: #4a90e2; text-align: center; }
</style>
</head>
<body>

<header>ØªØ°ÙƒÙŠØ± ÙˆÙØ§Ø¡</header>

<div class="container">
    <!-- ØªØ¨ÙˆÙŠØ¨ ØªØ°ÙƒÙŠØ± Ø¬Ø¯ÙŠØ¯ -->
    <div id="tab-new" class="tab-content">
        <h3 style="color:#4a90e2; text-align:center;">Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ± Ø¬Ø¯ÙŠØ¯</h3>

        <div class="form-group">
            <label>Ù†ÙˆØ¹ Ø§Ù„ØªØ°ÙƒÙŠØ±:</label>
            <select id="type">
                <option value="ØªØ°Ø§ÙƒØ±">ØªØ°Ø§ÙƒØ±</option>
                <option value="Ø¹Ù…Ø±Ø©">Ø¹Ù…Ø±Ø©</option>
                <option value="ØªØ£Ø´ÙŠØ±Ø§Øª">ØªØ£Ø´ÙŠØ±Ø§Øª</option>
                <option value="Ø¢Ø®Ø±">Ø¢Ø®Ø±</option>
            </select>
        </div>

        <div class="form-group">
            <label>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†:</label>
            <input type="text" id="title" placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ØªØ°ÙƒÙŠØ± Ù‡Ù†Ø§">
        </div>

        <div class="form-group">
            <label>ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØ°ÙƒÙŠØ±:</label>
            <input type="text" id="date" placeholder="Ø§Ø®ØªØ± Ø§Ù„ØªØ§Ø±ÙŠØ®">
        </div>

        <div class="form-group">
            <label>Ø§Ù„ÙˆÙ‚Øª:</label>
            <input type="text" id="time" placeholder="Ø§Ø®ØªØ± Ø§Ù„ÙˆÙ‚Øª">
        </div>

        <button onclick="addReminder()" style="width:100%; padding:12px; background:#4a90e2; color:white; border:none; border-radius:6px; font-size:1.1em; cursor:pointer;">
            ğŸ’¾ Ø­ÙØ¸ Ø§Ù„ØªØ°ÙƒÙŠØ±
        </button>
        <br><br>
        <button id="enablePush" style="width:100%; padding:12px; background:#888; color:white; border:none; border-radius:6px; font-size:1em; cursor:pointer;">
            ğŸ”” ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
        </button>
        <br><br>
        <button onclick="testSound()" style="width:100%; padding:12px; background:#555; color:white; border:none; border-radius:6px; font-size:1em; cursor:pointer;">
            ğŸ”Š Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª
        </button>
    </div>

    <!-- ØªØ¨ÙˆÙŠØ¨ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø© -->
    <div id="tab-upcoming" class="tab-content">
        <h3>Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</h3>
        <table id="upcomingTable">
            <thead>
                <tr>
                    <th>Ø§Ù„Ø¹Ù†ÙˆØ§Ù†</th>
                    <th>Ø§Ù„Ù†ÙˆØ¹</th>
                    <th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th>
                    <th>Ø§Ù„ÙˆÙ‚Øª</th>
                </tr>
            </thead>
            <tbody></tbody>
        </table>
    </div>
</div>

<!-- Ù†Ø§ÙØ°Ø© Ù…Ù†Ø¨Ø«Ù‚Ø© -->
<div id="popupOverlay"></div>
<div id="popup">
    <h3>ğŸ”” ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØªØ°ÙƒÙŠØ±</h3>
    <p id="popupText"></p>
    <button onclick="closePopup()">Ø¥ØºÙ„Ø§Ù‚</button>
</div>

<script>
let reminders = [];

// âœ… ÙƒÙˆØ¯ Firebase Ø§Ù„Ø®Ø§Øµ Ø¨Ùƒ
const firebaseConfig = {
  apiKey: "AIzaSyBvzdxIg12wzWobOco5WmcWR5oVdoVnsTM",
  authDomain: "reminders-app-5c038.firebaseapp.com",
  projectId: "reminders-app-5c038",
  storageBucket: "reminders-app-5c038.firebasestorage.app",
  messagingSenderId: "864515961662",
  appId: "1:864515961662:web:4d6afea2d97d07d859b26f",
  measurementId: "G-MQVVLYJ4H3"
};
firebase.initializeApp(firebaseConfig);
const messaging = firebase.messaging();

// âš ï¸ Ø¶Ø¹ÙŠ Ù‡Ù†Ø§ Ù…ÙØªØ§Ø­ VAPID Ø§Ù„Ø¹Ø§Ù… Ù…Ù† Cloud Messaging
const vapidKey = "YOUR_PUBLIC_VAPID_KEY";

// ØªØ³Ø¬ÙŠÙ„ Service Worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('/firebase-messaging-sw.js')
    .then(() => console.log('Service Worker Ù…Ø³Ø¬Ù‘Ù„'))
    .catch(err => console.error('ÙØ´Ù„ ØªØ³Ø¬ÙŠÙ„ SW', err));
}

// Ø²Ø± ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª
document.getElementById('enablePush').addEventListener('click', async () => {
  const permission = await Notification.requestPermission();
  if (permission !== 'granted') {
    alert('ØªÙ… Ø±ÙØ¶ Ø§Ù„Ø¥Ø°Ù†. Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª Ù„Ù† ØªØ¹Ù…Ù„.');
    return;
  }
  const reg = await navigator.serviceWorker.ready;
  messaging.useServiceWorker(reg);
  const token = await messaging.getToken({ vapidKey });
  console.log('FCM token:', token);
  alert('ØªÙ… ØªÙØ¹ÙŠÙ„ Ø§Ù„Ø¥Ø´Ø¹Ø§Ø±Ø§Øª âœ…');
});

// Ø²Ø± Ø§Ø®ØªØ¨Ø§Ø± Ø§Ù„ØµÙˆØª
function testSound(){
  try {
    const audio = new Audio("https://www.soundjay.com/button/beep-07.wav");
    audio.play();
    alert("ØªÙ… ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª âœ…");
  } catch(e){
    alert("ØªØ¹Ø°Ø± ØªØ´ØºÙŠÙ„ Ø§Ù„ØµÙˆØª âŒ");
  }
}

// Ø¥Ø¶Ø§ÙØ© ØªØ°ÙƒÙŠØ±
function addReminder(){
  const title = document.getElementById('title').value.trim();
  const type = document.getElementById('type').value;
  const date = document.getElementById('date').value;
  const time = document.getElementById('time').value;

  if(!title || !date || !time){ 
    alert("âš ï¸ Ø£Ø¯Ø®Ù„ ÙƒÙ„ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª"); 
    return; 
  }

  reminders.push({title,type,date,time});
  renderTables();
  alert("âœ… ØªÙ… Ø­ÙØ¸ Ø§Ù„ØªØ°ÙƒÙŠØ±");
}

// Ø¹Ø±Ø¶ Ø§Ù„ØªØ°ÙƒÙŠØ±Ø§Øª
function renderTables(){
  const tbody = document.getElementById('upcomingTable').querySelector('tbody');
  tbody.innerHTML='';
  reminders.forEach(r=>{
    const tr=document.createElement('tr');
        tr.innerHTML=`<td>${r.title}</td><td>${r.type}</td><td>${r.date}</td><td>${r.time}</td>`;
    tbody.appendChild(tr);
  });
}

function openPopup(text){
  document.getElementById('popupText').textContent=text;
  document.getElementById('popupOverlay').style.display='block';
  document.getElementById('popup').style.display='block';
}

function closePopup(){
  document.getElementById('popupOverlay').style.display='none';
  document.getElementById('popup').style.display='none';
}

// Ø§Ø³ØªÙ‚Ø¨Ø§Ù„ Ø±Ø³Ø§Ù„Ø© Ø£Ø«Ù†Ø§Ø¡ ÙØªØ­ Ø§Ù„ØµÙØ­Ø© Ù…Ù† Firebase
messaging.onMessage((payload) => {
  const n = payload.notification || {};
  const d = payload.data || {};
  const title = n.title || 'ØªÙ†Ø¨ÙŠÙ‡ Ø§Ù„ØªØ°ÙƒÙŠØ±';
  const body  = n.body  || d.body || `${d.type || ''} - ${d.title || ''} (${d.date || ''} ${d.time || ''})`;

  openPopup(`${title}\n${body}`);
  try { new Audio("https://www.soundjay.com/button/beep-07.wav").play(); } catch(e){}
});

// ØªÙ‡ÙŠØ¦Ø© Flatpickr
flatpickr("#date",{locale:"ar",dateFormat:"Y-m-d"});
flatpickr("#time",{enableTime:true,noCalendar:true,dateFormat:"H:i",time_24hr:true});

// Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª
function showTab(tab){
  document.querySelectorAll('.tab-content').forEach(el=>el.style.display='none');
  document.getElementById(tab).style.display='block';
}
showTab('tab-new');
</script>

<!-- Ø£Ø²Ø±Ø§Ø± Ø§Ù„ØªØ¨ÙˆÙŠØ¨Ø§Øª -->
<div class="tabs">
  <button onclick="showTab('tab-new')">â• ØªØ°ÙƒÙŠØ± Ø¬Ø¯ÙŠØ¯</button>
  <button onclick="showTab('tab-upcoming')">ğŸ“… Ø§Ù„Ù‚Ø§Ø¯Ù…Ø©</button>
</div>

</body>
</html>
